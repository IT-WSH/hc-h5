import{d as P,m as E,A as I,b as O,q as T,g as a,x as N,o as R,y as $,_ as A,k as g,C as J,t as X}from"./index-CxyPJWL_.js";const U=""+new URL("j_play-Bq0qZ3s1.png",import.meta.url).href,V=""+new URL("j-vyL_xLhg.png",import.meta.url).href,G={class:"canvasBox",style:{width:"100%",height:"100%",bottom:"0",left:"0"}},Z=["width","height"],H=P({__name:"Joystick",props:{bl:{default:100},isstart:{type:Boolean,default:!0}},emits:["getObj"],setup(Y,{emit:m}){const e=E({j_bg:"",j_play_bg:"",isStart:!1,top:0,left:0,jx:0,jy:0,josize:140,josize_bg:120,jisize:75,centerX:75,centerY:75,effectiveFinger:0,jc:null}),f=Y,h=m;I(()=>f.isstart,t=>{t&&z()},{immediate:!0}),I(()=>e.jx,t=>{if(t){let s=Math.ceil(Math.sqrt(e.jx*e.jx+e.jy*e.jy)),o={angle:"",size:e.josize_bg,distance:s,degrees:p(e.jx,e.jy)};t>0?Math.abs(e.jy)>Math.abs(e.jx)?e.jy>0?o.angle="down":o.angle="up":o.angle="right":t<=0&&(Math.abs(e.jy)>Math.abs(e.jx)?e.jy>0?o.angle="down":o.angle="up":o.angle="left"),v(h("getObj",o),100)}});function p(t,s){let n=Math.atan2(s,t)*(180/Math.PI);return n<0&&(n+=360),n.toFixed(4)}function v(t,s){let o;return function(...n){o&&clearTimeout(o),o=setTimeout(()=>{t.apply(this,n)},s)}}async function z(){await $(),console.log("初始化"),e.j_play_bg=await x(U),e.j_bg=await x(V);let t=Math.floor(f.bl);if(e.josize=t,!e.jc){const s=document.querySelector(".moveCanvas");e.jc=s==null?void 0:s.getContext("2d")}await u(),requestAnimationFrame(l)}async function u(){const t=await D(".canvasBox");return e.top=t.top||0,e.left=t.left||0,e.jisize=e.josize*.35,e.josize_bg=e.josize*.8,e.centerX=e.josize/2,e.centerY=e.josize/2,Promise.resolve()}function l(){var t,s,o;(t=e.jc)==null||t.clearRect(e.centerX-e.josize/2,e.centerY-e.josize/2,e.josize,e.josize),(s=e.jc)==null||s.drawImage(e.j_bg,(e.josize-e.josize_bg)/2,(e.josize-e.josize_bg)/2,e.josize_bg,e.josize_bg),(o=e.jc)==null||o.drawImage(e.j_play_bg,e.centerX-e.jisize/2+e.jx,e.centerY-e.jisize/2+e.jy,e.jisize,e.jisize),requestAnimationFrame(l)}function D(t){return new Promise(s=>{const n=document.querySelector(t).getBoundingClientRect();s(n)})}function x(t){return new Promise((s,o)=>{if(!t)return o();let n=new Image;n.src=t,n.onload=()=>{s(n)}})}async function q(t){t.preventDefault(),await u();let s="touches"in t?t.touches[e.effectiveFinger].clientX:t.clientX,o="touches"in t?t.touches[e.effectiveFinger].clientY:t.clientY,n=s-e.left,j=o-e.top;if(n>0&&n<e.josize&&j>0&&j<e.josize)e.isStart=!0;else return;if(Math.sqrt(Math.pow(n-e.centerX,2)+Math.pow(j-e.centerY,2))<=e.josize/2-e.jisize/2)e.jx=n-e.centerX,e.jy=j-e.centerY;else{var c=n,r=j,d=e.josize/2-e.jisize/2,i=S(e.centerX,e.centerY,d,e.centerX,e.centerY,c,r);Math.sqrt((i[0]-c)*(i[0]-c)+(i[1]-r)*(i[1]-r))<Math.sqrt((i[2]-c)*(i[2]-c)+(i[3]-r)*(i[3]-r))?(e.jx=i[0]-e.centerX,e.jy=i[1]-e.centerY):(e.jx=i[2]-e.centerX,e.jy=i[3]-e.centerY)}}function k(t){if(!e.isStart)return;let s="touches"in t?t.touches[e.effectiveFinger].clientX:t.clientX,o="touches"in t?t.touches[e.effectiveFinger].clientY:t.clientY,n=s-e.left,j=o-e.top;if(Math.sqrt(Math.pow(n-e.centerX,2)+Math.pow(j-e.centerY,2))<=e.josize/2-e.jisize/2)e.jx=n-e.centerX,e.jy=j-e.centerY;else{var c=n,r=j,d=e.josize/2-e.jisize/2,i=S(e.centerX,e.centerY,d,e.centerX,e.centerY,c,r);Math.sqrt((i[0]-c)*(i[0]-c)+(i[1]-r)*(i[1]-r))<Math.sqrt((i[2]-c)*(i[2]-c)+(i[3]-r)*(i[3]-r))?(e.jx=i[0]-e.centerX,e.jy=i[1]-e.centerY):(e.jx=i[2]-e.centerX,e.jy=i[3]-e.centerY)}}function y(){e.jx=0,e.jy=0,e.isStart=!1,h("getObj",{isStop:1})}function S(t,s,o,n,j,c,r){var d=(r-j)/(c-n),i=r-d*c,b,B,w,F,L=t*t+(i-s)*(i-s)-o*o,M=1+d*d,_=2*t-2*d*(i-s),C=Math.sqrt(_*_-4*M*L);return b=(_+C)/(2*M),B=d*b+i,w=(_-C)/(2*M),F=d*w+i,[b,B,w,F]}return(t,s)=>(R(),O("div",{style:T([{position:"relative"},{width:e.josize+"px",height:e.josize+"px"}])},[a("div",G,[a("canvas",{class:"moveCanvas",width:e.josize,height:e.josize,style:T({width:e.josize+"px",height:e.josize+"px"})},null,12,Z)]),a("div",{class:N(["move-dom",{active:e.isStart}]),onTouchstart:q,onTouchmove:k,onTouchend:y,onTouchcancel:y,onMousemove:k,onMousedown:q,onMouseup:y},null,34)],4))}}),K=A(H,[["__scopeId","data-v-76f1d70f"]]),Q={class:"joystick-container"},W={class:"joystick-wrapper"},ee={class:"info-panel"},te={class:"data-display"},ie={class:"data-item"},se={class:"data-value"},oe={class:"data-item"},ne={class:"data-value"},ae={class:"data-item"},ce={class:"data-value"},re=P({__name:"joystick",setup(Y){const m=g(200),e=g(),f=g("无"),h=g(0),p=g(0);function v(u){f.value=z(u.angle),h.value=Math.round(u.degrees)||0,p.value=Math.round(u.distance*100)/100||0}function z(u){return{up:"上",down:"下",left:"左",right:"右",up_left:"左上",up_right:"右上",down_left:"左下",down_right:"右下"}[u]||u}return(u,l)=>(R(),O("div",Q,[a("div",W,[J(K,{onGetObj:v,ref_key:"myMove",ref:e,isstart:!0,bl:m.value},null,8,["bl"])]),a("div",ee,[l[3]||(l[3]=a("h3",null,"摇杆数据",-1)),a("div",te,[a("div",ie,[l[0]||(l[0]=a("span",{class:"data-label"},"方向:",-1)),a("span",se,X(f.value||"无"),1)]),a("div",oe,[l[1]||(l[1]=a("span",{class:"data-label"},"角度:",-1)),a("span",ne,X(h.value)+"°",1)]),a("div",ae,[l[2]||(l[2]=a("span",{class:"data-label"},"距离:",-1)),a("span",ce,X(p.value),1)])])])]))}}),je=A(re,[["__scopeId","data-v-d40b87d5"]]);export{je as default};
