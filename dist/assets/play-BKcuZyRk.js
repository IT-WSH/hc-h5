import{d as R,k as v,A as ae,l as te,B as se,_ as H,b as p,g as s,e as I,F as J,n as L,x as z,z as T,t as _,o as m,C as V,D as j,f as ne}from"./index-CxyPJWL_.js";const le=[[[1,1,1,1]],[[1,1],[1,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]],[[1,1,1],[0,1,0]],[[1,1,1],[0,0,1]],[[1,1,1],[1,0,0]]],oe=R({setup(a,{emit:e}){console.log(a);const l=v("ready"),g=v(Array.from({length:20},()=>Array(10).fill(0))),n=v([]),h=v([]),r=v(0),d=v(0),y=v(0),c=v(null),$=v(500),w=v([]),C=v([]),U=o=>{const t=[...o];for(let u=t.length-1;u>0;u--){const f=Math.floor(Math.random()*(u+1));[t[u],t[f]]=[t[f],t[u]]}return t},P=()=>{C.value=U([...le])},M=()=>{C.value.length===0&&P(),h.value.length>0?n.value=JSON.parse(JSON.stringify(h.value)):n.value=JSON.parse(JSON.stringify(C.value.pop()))},i=()=>{C.value.length===0&&P(),h.value=JSON.parse(JSON.stringify(C.value.pop())),e("nextPieceChanged",h.value)},k=()=>{g.value=Array.from({length:20},()=>Array(10).fill(0)),y.value=0,l.value="playing",$.value=500,P(),M(),i(),r.value=Math.floor((10-n.value[0].length)/2),d.value=0,D(),N(),e("scoreUpdated",y.value)},E=()=>{for(let o=0;o<n.value.length;o++)for(let t=0;t<n.value[o].length;t++)if(n.value[o][t]){const u=d.value+o,f=r.value+t;u>=0&&(g.value[u][f]=1)}if(d.value<=0){q();return}S(),M(),i(),r.value=Math.floor((10-n.value[0].length)/2),d.value=0,F(r.value,d.value)&&q(),N()},O=()=>{if(l.value!=="playing")return;const o=n.value[0].map((t,u)=>n.value.map(f=>f[u]).reverse());if(!F(r.value,d.value,o))n.value=o,N();else{const t=[-1,1,-2,2];for(const u of t)if(!F(r.value+u,d.value,o)){r.value+=u,n.value=o,N();break}}},F=(o,t,u=n.value)=>{for(let f=0;f<u.length;f++)for(let b=0;b<u[f].length;b++)if(u[f][b]){const X=o+b,Y=t+f;if(X<0||X>=10||Y>=20||Y>=0&&g.value[Y][X])return!0}return!1},G=o=>{if(l.value!=="playing")return;let t=r.value,u=d.value;switch(o){case"left":t--;break;case"right":t++;break;case"down":u++;break}F(t,u)?o==="down"&&E():(r.value=t,d.value=u,N(),o==="down"&&A())},S=()=>{let o=0;for(let t=g.value.length-1;t>=0;t--)g.value[t].every(u=>u)&&(g.value.splice(t,1),g.value.unshift(Array(10).fill(0)),o++,t++);if(o>0){const t=[0,100,300,500,800][o]||800;y.value+=t,e("scoreUpdated",y.value),y.value>1e3&&$.value>200&&($.value=Math.max(200,500-Math.floor(y.value/1e3)*50),A())}},D=()=>{B(),c.value=setInterval(()=>{l.value==="playing"&&G("down")},$.value)},A=()=>{c.value&&(clearInterval(c.value),D())},B=()=>{c.value&&(clearInterval(c.value),c.value=null)},W=()=>{(l.value==="ready"||l.value==="gameover")&&k()},K=()=>{l.value==="playing"&&(l.value="paused",B())},Z=()=>{l.value==="paused"&&(l.value="playing",D())};ae(l,()=>{x()});const x=()=>{e("gameState",l.value)},q=()=>{l.value="gameover",B(),e("gameOver",y.value)},ee=()=>{B(),k()},N=()=>{const o=JSON.parse(JSON.stringify(g.value));for(let t=0;t<n.value.length;t++)for(let u=0;u<n.value[t].length;u++)if(n.value[t][u]){const f=d.value+t,b=r.value+u;f>=0&&f<20&&b>=0&&b<10&&(o[f][b]=1)}w.value=o.flat()},Q=o=>{if(l.value==="playing")switch(o.preventDefault(),o.key){case"ArrowLeft":G("left");break;case"ArrowRight":G("right");break;case"ArrowDown":G("down");break;case"ArrowUp":O();break;case"p":case"P":K();break;case" ":for(;!F(r.value,d.value+1);)d.value++;E();break}};return te(()=>{window.addEventListener("keydown",Q)}),se(()=>{window.removeEventListener("keydown",Q),B()}),{flattenedBoard:w,score:y,gameStatus:l,startGame:W,pauseGame:K,resumeGame:Z,resetGame:ee,getNextPiece:()=>h.value,emitNextPiece:()=>e("nextPieceChanged",h.value)}}}),ue={class:"game-board"},re={class:"board-grid"},ie={key:0,class:"game-overlay welcome-overlay"},de={class:"overlay-content welcome-content"},ce={key:1,class:"game-overlay"},ve={class:"overlay-content"},fe={key:2,class:"game-overlay"},pe={class:"overlay-content"};function me(a,e,l,g,n,h){return m(),p("div",ue,[s("div",re,[(m(!0),p(J,null,L(a.flattenedBoard,(r,d)=>(m(),p("div",{key:d,class:z(["cell",{filled:r}])},null,2))),128))]),a.gameStatus==="ready"?(m(),p("div",ie,[s("div",de,[e[3]||(e[3]=T('<h2 data-v-68dc93fa>俄罗斯方块</h2><div class="welcome-description" data-v-68dc93fa><p data-v-68dc93fa>经典游戏，挑战你的极限！</p><div class="features" data-v-68dc93fa><div class="feature-item" data-v-68dc93fa><span class="feature-icon" data-v-68dc93fa>🎮</span><span data-v-68dc93fa>经典玩法</span></div><div class="feature-item" data-v-68dc93fa><span class="feature-icon" data-v-68dc93fa>🏆</span><span data-v-68dc93fa>排行榜</span></div><div class="feature-item" data-v-68dc93fa><span class="feature-icon" data-v-68dc93fa>🚀</span><span data-v-68dc93fa>难度提升</span></div></div></div>',2)),s("button",{class:"start-button",onClick:e[0]||(e[0]=(...r)=>a.startGame&&a.startGame(...r))},"开始游戏")])])):I("",!0),a.gameStatus==="gameover"?(m(),p("div",ce,[s("div",ve,[e[4]||(e[4]=s("h2",null,"游戏结束",-1)),s("p",null,"最终得分: "+_(a.score),1),s("button",{onClick:e[1]||(e[1]=(...r)=>a.resetGame&&a.resetGame(...r))},"重新开始")])])):I("",!0),a.gameStatus==="paused"?(m(),p("div",fe,[s("div",pe,[e[5]||(e[5]=s("h2",null,"游戏暂停",-1)),s("button",{onClick:e[2]||(e[2]=(...r)=>a.resumeGame&&a.resumeGame(...r))},"继续游戏")])])):I("",!0)])}const ge=H(oe,[["render",me],["__scopeId","data-v-68dc93fa"]]),he=R({props:{score:{type:Number,default:0}}}),ye={class:"score-board"},ke={class:"score-value"};function Ce(a,e,l,g,n,h){return m(),p("div",ye,[e[0]||(e[0]=s("h3",null,"当前分数",-1)),s("div",ke,_(a.score),1)])}const $e=H(he,[["render",Ce],["__scopeId","data-v-77e462d8"]]),Fe=R({props:{rankData:{type:Array,default:()=>[]}}}),Ge={class:"rank-board"},be={class:"rank-list"},Ee={class:"rank-number"},Be={class:"rank-info"},we={class:"player-name"},Se={class:"score"};function De(a,e,l,g,n,h){return m(),p("div",Ge,[e[0]||(e[0]=s("h3",null,"分数排行",-1)),s("div",be,[(m(!0),p(J,null,L(a.rankData,(r,d)=>(m(),p("div",{key:d,class:z(["rank-item",`rank-${d+1}`])},[s("div",Ee,_(d+1),1),s("div",Be,[s("div",we,_(r.name),1),s("div",Se,_(r.score)+"分",1)])],2))),128))])])}const _e=H(Fe,[["render",De],["__scopeId","data-v-7d909ad3"]]),Pe=R({components:{GameBoard:ge,ScoreBoard:$e,RankBoard:_e},setup(){const a=v(null),e=v(0),l=v(!1),g=v(!1),n=v([]),h=v([[]]),r=()=>{const i=localStorage.getItem("tetrisRankData");i&&(n.value=JSON.parse(i))};function d(i="female"){const k=["璀璨","皎洁","苍穹","星河","月影","晨曦","流风","霜雪","翡翠","琉璃","银翼","圣光","幻梦","星轨","永夜","天籁"],E=["精灵","歌姬","玫瑰","蝶舞","百合","天鹅","人鱼","月光","花语","星尘","蔷薇","仙灵","诗篇","铃音","羽衣","晨露"],O=["战神","龙裔","圣剑","苍穹","烈阳","铁壁","雷霆","星陨","狼魂","君王","裁决","天启","荒原","怒涛","孤峰","远征"],F=["之风","之翼","咏叹","挽歌","行者","使者","传承","契约","守望","誓言","咏唱","低语","咏叹","幻象","终章","序曲"],G=k[Math.floor(Math.random()*k.length)],S=i==="male"?O[Math.floor(Math.random()*O.length)]:E[Math.floor(Math.random()*E.length)],D=F[Math.floor(Math.random()*F.length)],A=[()=>`${G}的${S}·${D}`,()=>`${S}${D}`,()=>`${G}${S}`,()=>`${S}之${G}`],B=A[Math.floor(Math.random()*A.length)];return B().replace(/·/g,"·").replace(/\s+/g,"")}const y=i=>{e.value=i},c=d(),$=()=>{if(console.log("游戏结束"),e.value<=0)return;const i=n.value.findIndex(k=>k.name===c);i>=0?n.value[i].score=Math.max(n.value[i].score,e.value):n.value.push({name:c,score:e.value}),n.value.sort((k,E)=>E.score-k.score),n.value=n.value.slice(0,10),localStorage.setItem("tetrisRankData",JSON.stringify(n.value))},w=i=>{h.value=i},C=()=>{var i;(i=a.value)==null||i.startGame(),l.value=!1},U=()=>{var i,k;l.value?(i=a.value)==null||i.resumeGame():(k=a.value)==null||k.pauseGame(),l.value=!l.value},P=()=>{var i;(i=a.value)==null||i.resetGame(),l.value=!1},M=i=>{i=="playing"?l.value=!1:l.value=!0};return r(),{gameBoardRef:a,score:e,isPaused:l,showHelp:g,rankData:n,nextPieceFlattened:h,updateScore:y,handleGameOver:$,updateNextPiece:w,startGame:C,pauseGame:U,resetGame:P,gameState:M}}}),Ae={class:"game-page"},Ne={class:"game-container"},Me={class:"game-board-wrapper"},Oe={class:"control-panel"},Ie={class:"panel-section control-buttons"},Je={class:"panel-section next-piece-panel"},Le={class:"next-piece-main"},Re={class:"modal-content"},He={class:"modal-header"};function Ue(a,e,l,g,n,h){const r=j("GameBoard"),d=j("ScoreBoard"),y=j("RankBoard");return m(),p("div",Ae,[s("div",Ne,[s("div",Me,[V(r,{ref:"gameBoardRef",onScoreUpdated:a.updateScore,onGameOver:a.handleGameOver,onNextPieceChanged:a.updateNextPiece,onGameState:a.gameState},null,8,["onScoreUpdated","onGameOver","onNextPieceChanged","onGameState"])]),s("div",Oe,[V(d,{score:a.score,class:"panel-section"},null,8,["score"]),s("div",Ie,[s("button",{class:"btn-start",onClick:e[0]||(e[0]=(...c)=>a.startGame&&a.startGame(...c))},"开始游戏"),s("button",{class:"btn-pause",onClick:e[1]||(e[1]=(...c)=>a.pauseGame&&a.pauseGame(...c))},_(a.isPaused?"继续":"暂停"),1),s("button",{class:"btn-reset",onClick:e[2]||(e[2]=(...c)=>a.resetGame&&a.resetGame(...c))},"重新开始"),s("button",{class:"btn-help",onClick:e[3]||(e[3]=c=>a.showHelp=!0)},"操作说明")]),s("div",Je,[e[6]||(e[6]=s("h3",null,"下一个方块",-1)),s("div",Le,[(m(!0),p(J,null,L(a.nextPieceFlattened,(c,$)=>(m(),p("div",{class:"next-piece-grid",key:$},[(m(!0),p(J,null,L(c,(w,C)=>(m(),p("div",{key:C,class:z(["next-piece-cell",{filled:w}])},null,2))),128))]))),128))])]),V(y,{rankData:a.rankData,class:"panel-section"},null,8,["rankData"])])]),a.showHelp?(m(),p("div",{key:0,class:"modal-overlay",onClick:e[5]||(e[5]=ne(c=>a.showHelp=!1,["self"]))},[s("div",Re,[s("div",He,[e[7]||(e[7]=s("h3",null,"操作说明",-1)),s("button",{class:"modal-close",onClick:e[4]||(e[4]=c=>a.showHelp=!1)},"×")]),e[8]||(e[8]=T('<div class="modal-body" data-v-6e2099a9><ul class="instruction-list" data-v-6e2099a9><li data-v-6e2099a9><span class="key" data-v-6e2099a9>← →</span> 左右移动</li><li data-v-6e2099a9><span class="key" data-v-6e2099a9>↑</span> 旋转方块</li><li data-v-6e2099a9><span class="key" data-v-6e2099a9>↓</span> 加速下落</li><li data-v-6e2099a9><span class="key" data-v-6e2099a9>空格</span> 直接落到底部</li><li data-v-6e2099a9><span class="key" data-v-6e2099a9>P</span> 暂停/继续</li></ul><div class="scoring-rules" data-v-6e2099a9><h4 data-v-6e2099a9>得分规则</h4><ul data-v-6e2099a9><li data-v-6e2099a9>消除1行: 100分</li><li data-v-6e2099a9>消除2行: 300分</li><li data-v-6e2099a9>消除3行: 500分</li><li data-v-6e2099a9>消除4行: 800分</li></ul></div></div>',1))])])):I("",!0)])}const Ye=H(Pe,[["render",Ue],["__scopeId","data-v-6e2099a9"]]);export{Ye as default};
